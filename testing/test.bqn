# LINUX ONLY: tests intended only to be run on linux with cc as the c compiler

â€¢Out "Finding examples to test"
examplesDir â† "../examples"
exampleFiles â† (â€¢file.Listâˆ¾Â¨ËœâŸœ<'/'âˆ¾ËœâŠ¢){âˆ¾ğ”½Â¨ğ”½ğ•©} examplesDir
testFiles â† ("parse"âŠ¸(âŠ£â‰¡â‰ âŠ¸â†‘)âˆ§".bqn"âŠ¸(âŠ£â‰¡-âˆ˜â‰ âŠ¸â†‘))âˆ˜(âˆ§`âŒ¾âŒ½âˆ˜â‰ âŸœ'/'âŠ¸/)Â¨âŠ¸/exampleFiles

outputFailedJSONFiles â† 0

SH â† {exitcodeâ€¿stdoutâ€¿stderrâ†â€¢SHğ•©
  â€¢term.OutRaw stdout
  stderr!0=exitcode
}

{
  â€¢Out "Testing "âˆ¾ğ•©
  â€¢term.OutRaw "    "
  â€¢Import ğ•©
}Â¨testFiles

# compile c parser
parserPath â† "./raylib_parser.c"
binLocation â† "/tmp/a.out"

â€¢Out ""
â€¢Out "Attempting to compile raylib_parser.c to compare outputs"
â€¢Out ""
SH "cc"â€¿parserPathâ€¿"-o"â€¿binLocation


âŸ¨JsonToFFIâ‹„ParseHeaderâ‹„ToPrettyJsonâŸ© â† â€¢Import "../parse.bqn"
json â† â€¢Import "../json.bqn"

raylibOutputTestcases â† {ğ•ŠpathToFile:
  path â† âˆ¨`âŒ¾âŒ½âˆ˜=âŸœ'/'âŠ¸/pathToFile
  headerPath â† âŠ‘".h"âŠ¸(âŠ£â‰¡-âˆ˜â‰ âŠ¸â†‘)Â¨âŠ¸/(<âˆ¾Â¨â€¢file.List)path
  
  raylibJsonTempLoc â† "temp.json"
  tmpHeaderPath â† "temp.h"
  
  tmpHeaderPath â€¢FChars â€¢FChars headerPath
  raylibJsonTempLoc â€¢FChars ""
  â€¢Out "Parsing "âˆ¾headerPathâˆ¾" with raylib_parser.c and parse.bqn"
  SH binLocationâ€¿"-i"â€¿tmpHeaderPathâ€¿"-o"â€¿raylibJsonTempLocâ€¿"-d"â€¿"RLAPI"
  â€¢file.Remove tmpHeaderPath
  cMadeJson â† â€¢FChars raylibJsonTempLoc
  â€¢file.Remove raylibJsonTempLoc
  bqnMadeJson â† (@+10)âˆ¾ËœToPrettyJson "RLAPI" ParseHeader â€¢FChars headerPath
  â€¢Out "Parsing successful"
  correct â† cMadeJson â‰¡ bqnMadeJson
  â€¢Out "testcase "âˆ¾headerPathâˆ¾correctâŠ‘" failed"â€¿" succeded"
  {ğ•¤
    nameâ† âˆ§`âˆ˜â‰ âŸœ'.'âŠ¸/âˆ§`âŒ¾âŒ½âˆ˜â‰ âŸœ'/'âŠ¸/pathToFile
    cLoc â† nameâˆ¾"C.json"
    bqnLoc â† nameâˆ¾"BQN.json"
    â€¢Out "Outputting files as "âˆ¾cLocâˆ¾" and "âˆ¾bqnLoc
    cLoc â€¢FChars cMadeJson
    bqnLoc â€¢FChars bqnMadeJson
  }âŸâŠ¢correctâˆ§outputFailedJSONFiles
  â€¢Out ""
}Â¨testFiles

â€¢file.Remove binLocation
